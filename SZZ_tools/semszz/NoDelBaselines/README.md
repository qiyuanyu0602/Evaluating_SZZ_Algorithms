# Introduction
This is the replication package for the paper titled "SZZ for Vulnerability: Automatic Identification of Version Ranges Affected by CVE Vulnerabilities". 

# Folders
- **ASTMapEval_jar**: the AST mapping algorithms for Java projects implemented by Fan et al. Note that you might need change the repo path in the config file of *ASTMapEval.jar*. 
- **data**: the data folder
    > *c_cve_fix_detail.json* and *java_cve_fix_detail.json* are the datasets of the vulnerability-fixing commits from C/C++ and Java projects, respectively.

    > *label.json* contains the annotated CVE vulneraiblities with the previous commits and descendents commits.

    > *verified_cve_with_versions_C.json* and *verified_cve_with_versions_Java.json* contain vulnerabilities with the version information in the CVE desription, fixing commits, the commits that contain the same change as the fixing commits, the vulnerable versions generated by our approach for each inducing commit, etc.

- **data_commit_patch_map**: contains the mappings between commit and hunks, please refer to the source code in *identify_duplicated_patch.py*.

- **git_analysis**: some python source code for retrieving Git logs generated by *log_generation.py*.

- **GitLogs**: stores the Git logs generated by *log_generation.py*.

- **icse2021-szz-replication-package**: the SZZ implementation prodived by Rosa et al. (ICSE2021). Our SZZ algorithms V-SZZ also extends their implementation, please see tools/pyszz/szz/my_szz.py.

- **VulAnalysisWeb**: the web interface for annotating inducing commits for vulnerabilities, which is based on [Flask](https://flask.palletsprojects.com/en/2.0.x/).

# Usage
- Please search the **TODO** comments in the source code to change some file paths due to double blind review.

- **Run the web interface for manual annotation**
    + Prepare the mongodb to store CVE information from [cve-search](https://www.cve-search.org/). 
    + > cd VulAnalysisWeb; python server.py
   
- **Run SZZ algorithms**
    + Please refer to the implementation of the SZZ algorithms used in our study in the *icse2021-szz-replication-package/tools/pyszz/szz*. 
    + To run the SZZ algorithms, please see the source code in *main.py*, the parameter *method* indicates the SZZ algorithms.
        - B-SZZ ==> b
        - AG-SZZ ==> ag
        - MA-SZZ ==> ma
        - RA-SZZ ==> ra
        - V-SZZ ==> my
  
- **Generate Vulnerable version tags**
    Please refer to the source code in *extract_tag.py*.
    + Step 1: generate Git log in local machine. 
    ```python
        for project in projects:
            try:
                log_out = os.path.join(LOG_DIR, project+"-meta.log")
                generate_logs(os.path.join(repos_dir, project), log_out)
            except Exception as e:
                print(project, e)
    ```

    + Step 2: generate hashes for hunks in commits, see identify_duplicated_patch.py
    ```python
        from identify_duplicated_patch import batch_duplicate_detection
        batch_duplicate_detection(projects)
    ```

    + Step 3: generate vulnerable version tags for the annoated projects
    ```python
        generate_version_annoated(projects)
    ```

